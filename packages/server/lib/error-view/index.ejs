<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <link rel="stylesheet" href="http://localhost:3101/__error-overlay-static/overlay.css">
    <title>IMA.js - Server Error</title>
  </head>

  <body>
    <div id="root"></div>
    <script>
      window.__ima_server_error = <%- JSON.stringify(serverError) %>;
    </script>
    <script src="http://localhost:3101/__error-overlay-static/overlay.js"></script>
    <script>
      (() => {
        function debounce(func, timeout) {
          let timer;

          return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => {
              func.apply(this, args);
            }, timeout);
          };
        }

        const debouncedReload = debounce(() => window.location.reload(), 100);
        const evtSource = new EventSource('http://localhost:3101/__webpack_hmr');

        evtSource.addEventListener('message', () => {
          if (event.data && typeof event.data === 'string' && event.data.includes('action')) {
            try {
              const data = JSON.parse(event.data);
              if (data?.action === 'built' && data?.errors.length === 0) {
                debouncedReload()
              }
            } catch (error) {
              console.error('Something unexpected happened when parsing HMR event stream', error);
            }
          }
        });
      })();
    </script>
  </body>

</html>
