"use strict";(self.webpackChunk_ima_docs=self.webpackChunk_ima_docs||[]).push([[9450],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>d});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)t=o[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),p=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},u=function(e){var n=p(e.components);return i.createElement(l.Provider,{value:n},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(t),m=r,d=c["".concat(l,".").concat(m)]||c[m]||g[m]||o;return t?i.createElement(d,a(a({ref:n},u),{},{components:t})):i.createElement(d,a({ref:n},u))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,a=new Array(o);a[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[c]="string"==typeof e?e:r,a[1]=s;for(var p=2;p<o;p++)a[p]=t[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},8110:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var i=t(5773),r=(t(7294),t(3905));const o={title:"Plugins API",description:"Plugins > Plugins API"},a=void 0,s={unversionedId:"plugins/plugin-interface",id:"plugins/plugin-interface",title:"Plugins API",description:"Plugins > Plugins API",source:"@site/../docs/plugins/plugin-interface.md",sourceDirName:"plugins",slug:"/plugins/plugin-interface",permalink:"/plugins/plugin-interface",draft:!1,editUrl:"https://github.com/seznam/ima/tree/docusaurus/docs/../docs/plugins/plugin-interface.md",tags:[],version:"current",lastUpdatedBy:"Filip Satek",lastUpdatedAt:1673520109,formattedLastUpdatedAt:"Jan 12, 2023",frontMatter:{title:"Plugins API",description:"Plugins > Plugins API"},sidebar:"docs",previous:{title:"LESS Constants Plugin",permalink:"/cli/plugins/less-constants-plugin"},next:{title:"Existing plugins",permalink:"/plugins/available-plugins"}},l={},p=[{value:"Plugin registration",id:"plugin-registration",level:2},{value:"Plugin bootstrap functions",id:"plugin-bootstrap-functions",level:3},{value:"initBind",id:"initbind",level:4},{value:"initServices",id:"initservices",level:4},{value:"initSettings",id:"initsettings",level:4},{value:"Examples",id:"examples",level:3},{value:"Conclusion",id:"conclusion",level:2}],u={toc:p};function c(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,i.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"IMA.js development stack offers ",(0,r.kt)("strong",{parentName:"p"},"built-in support for plugins"),". Writing plugins for IMA.js is really\nsimple. It basically comes to creating an ordinary npm package and using ",(0,r.kt)("inlineCode",{parentName:"p"},"pluginLoader.register")," method to hook into IMA.js application environment using certain functions."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"In situations where you don't need to hook into IMA.js app environment from within your plugin (you're for example just exporting some interface), you don't need call this registration method as it servers no purpose.")),(0,r.kt)("h2",{id:"plugin-registration"},"Plugin registration"),(0,r.kt)("p",null,"As mentioned above, the plugin registration is done from within your ",(0,r.kt)("strong",{parentName:"p"},"npm package entry point")," using ",(0,r.kt)("inlineCode",{parentName:"p"},"pluginLoader.register")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { pluginLoader } from '@ima/core';\nimport Service from './service';\n\npluginLoader.register('my-ima-plugin', ns => {\n  ns.set('my.ima.plugin.Service', Service);\n});\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"register")," method expects 2 arguments, first is ",(0,r.kt)("strong",{parentName:"p"},"name of your plugin")," (this is used strictly for debugging purposes, however it is required) and ",(0,r.kt)("strong",{parentName:"p"},"callback registration function")," which receives ",(0,r.kt)("a",{parentName:"p",href:"/api/modules/ima_core#ns"},(0,r.kt)("inlineCode",{parentName:"a"},"Namespace"))," as one and only argument, that you can use to specify to which namespace this plugin should be bound."),(0,r.kt)("h3",{id:"plugin-bootstrap-functions"},"Plugin bootstrap functions"),(0,r.kt)("p",null,"The registration function can additionally ",(0,r.kt)("strong",{parentName:"p"},"return an object with additional callback functions"),". These allow you to further bootstrap your plugin. All are however optional, meaning you can define any combination of these or don't return anything."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { pluginLoader } from '@ima/core';\n\npluginLoader.register('my-ima-plugin', ns => {\n  return {\n    initBind: (ns, oc, config) => {}\n    initServices: (ns, oc, config) => {}\n    initSettings: (ns, oc, config) => {}\n  }\n});\n")),(0,r.kt)("h4",{id:"initbind"},"initBind"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"initBind(ns: Namespace, oc: ObjectContainer, config: Config['bind'])"))),(0,r.kt)("p",null,"This function has the same interface as a function exported in ",(0,r.kt)("inlineCode",{parentName:"p"},"bind.js")," of your IMA.js application and also serves the same purpose. This is the place where you would want to initialize your custom constants and bindings and assign them to the ",(0,r.kt)("a",{parentName:"p",href:"/basic-features/object-container"},(0,r.kt)("inlineCode",{parentName:"a"},"ObjectContainer")),"."),(0,r.kt)("h4",{id:"initservices"},"initServices"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"initServices(ns: Namespace, oc: ObjectContainer, config: Config['services'])"))),(0,r.kt)("p",null,"Similarly to ",(0,r.kt)("inlineCode",{parentName:"p"},"initBind"),", this is equivalent to a function exported by ",(0,r.kt)("inlineCode",{parentName:"p"},"services.js")," file in your application."),(0,r.kt)("h4",{id:"initsettings"},"initSettings"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"initSettings(ns: Namespace, oc: ObjectContainer, config: Config['settings'])"))),(0,r.kt)("p",null,"You can probably already see the pattern here. This function should return an object with settings, with the same structure as function in ",(0,r.kt)("inlineCode",{parentName:"p"},"settings.js")," file does."),(0,r.kt)("p",null,"These settings are then ",(0,r.kt)("strong",{parentName:"p"},"merged with your application settings")," a possible conflicts are overridden with the application settings. This allows you to ",(0,r.kt)("strong",{parentName:"p"},"define defaults for your plugin"),", which can be easily overridden in your application."),(0,r.kt)("h3",{id:"examples"},"Examples"),(0,r.kt)("p",null,"Putting it all together, your main file in your npm package could look something like this (borrowing contents of ",(0,r.kt)("inlineCode",{parentName:"p"},"main.js")," from our ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/seznam/IMA.js-plugins/blob/master/packages/plugin-useragent/README.md"},"@ima/plugin-useragent"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { pluginLoader } from '@ima/core';\nimport PlatformJS from 'platform';\n\nimport UserAgent from './AbstractUserAgent.js';\nimport ClientUserAgent from './ClientUserAgent.js';\nimport ServerUserAgent from './ServerUserAgent.js';\n\npluginLoader.register('@ima/plugin-useragent', () => {\n  return {\n    initBind: (ns, oc) => {\n      if (oc.get('$Window').isClient()) {\n        oc.provide(UserAgent, ClientUserAgent, [PlatformJS, '$Window']);\n      } else {\n        oc.provide(UserAgent, ServerUserAgent, [PlatformJS, '$Request']);\n      }\n    },\n    initServices: (ns, oc) => {\n      oc.get(UserAgent).init();\n    },\n  };\n});\n\nexport { ClientUserAgent, ServerUserAgent, UserAgent, PlatformJS };\n")),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"As you can see, creating IMA.js plugin is very easy. You can always check our\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/seznam/IMA.js-plugins/tree/master"},"IMA.js-plugins")," monorepo to take a look at many other already\nexisting plugins and how they're implemented, which we describe more in detail ",(0,r.kt)("a",{parentName:"p",href:"./available-plugins"},"in the documentation"),"."))}c.isMDXComponent=!0}}]);